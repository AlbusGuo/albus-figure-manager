# 测试指南

## 构建状态
✅ **构建成功！** 所有 TypeScript 代码已成功编译。

生成的文件：
- `main.js` (221 KB) - 插件主代码
- `styles.css` (16 KB) - 样式文件  
- `manifest.json` - 插件清单

## 手动测试步骤

### 1. 安装到 Obsidian

将以下文件复制到你的 vault 的插件目录：

```
<你的Vault>/.obsidian/plugins/albus-figure-manager/
├── main.js
├── manifest.json
└── styles.css
```

**PowerShell 命令示例：**
```powershell
# 替换为你的 vault 路径
$vaultPath = "D:\你的Vault路径"
$pluginDir = "$vaultPath\.obsidian\plugins\albus-figure-manager"

# 创建插件目录
New-Item -ItemType Directory -Path $pluginDir -Force

# 复制文件
Copy-Item main.js, manifest.json, styles.css -Destination $pluginDir
```

### 2. 在 Obsidian 中启用插件

1. 打开 Obsidian
2. 进入 **设置 → 社区插件**
3. 关闭"安全模式"（如果已启用）
4. 在已安装的插件列表中找到 "Albus Figure Manager"
5. 启用插件

### 3. 配置插件

1. 进入 **设置 → Albus Figure Manager**
2. 配置以下选项：
   - **默认文件夹路径**：设置图片存储的默认文件夹（例如：`Assets/Images`）
   - **显示选项**：
     - 显示文件大小
     - 显示修改时间
   - **行为选项**：
     - 加载时自动检查引用
     - 默认过滤未引用图片
     - 双击打开图片
     - 删除前确认

### 4. 测试功能

#### 4.1 打开图片管理器

**方式一：使用功能区图标**
- 点击左侧边栏的图片图标

**方式二：使用命令面板**
- 按 `Ctrl+P`（Windows/Linux）或 `Cmd+P`（Mac）
- 输入 "打开图片管理器"
- 按回车

#### 4.2 测试图片加载

1. 确保你的 vault 中有一些图片文件
2. 在图片管理器中应该能看到图片网格
3. 验证以下信息是否正确显示：
   - 图片缩略图
   - 文件名
   - 文件大小（如果启用）
   - 修改时间（如果启用）

#### 4.3 测试搜索和过滤

1. **搜索功能**：
   - 在搜索框中输入文件名的一部分
   - 验证图片列表是否正确过滤

2. **排序功能**：
   - 测试按以下方式排序：
     - 文件名（升序/降序）
     - 修改时间（最新/最旧）
     - 文件大小（最大/最小）

3. **过滤功能**：
   - 勾选"仅显示未引用图片"
   - 验证只显示未被任何笔记引用的图片

#### 4.4 测试引用检查

1. 点击"检查引用"按钮
2. 等待检查完成
3. 验证：
   - 已引用的图片显示引用信息
   - 未引用的图片显示"未引用"状态
   - 点击引用文件名可以跳转到对应笔记

#### 4.5 测试文件操作

1. **双击打开图片**：
   - 双击图片卡片
   - 验证图片是否在新标签页中打开

2. **预览功能**：
   - 点击图片卡片上的"预览"按钮
   - 验证预览模态框是否正确显示
   - 测试缩放和拖动功能

3. **重命名功能**：
   - 点击"重命名"按钮
   - 输入新文件名
   - 验证文件是否成功重命名
   - 如果是 AGX 文件，验证对应的 SVG 文件是否也被重命名

4. **删除功能**：
   - 点击"删除"按钮
   - 验证是否显示确认对话框（如果启用）
   - 确认删除
   - 验证文件是否被移到回收站
   - 如果是 AGX 文件，验证对应的 SVG 文件是否也被删除

#### 4.6 测试 AGX 文件支持

如果你有 AGX 文件（Excalidraw 格式）：

1. 验证 AGX 文件是否与对应的 SVG 文件正确配对
2. 验证缩略图显示的是 SVG 而不是 AGX
3. 测试重命名和删除时是否同时处理 AGX 和 SVG

### 5. 性能测试

1. **大量图片**：
   - 在包含 100+ 图片的文件夹中测试
   - 验证加载速度和响应性

2. **引用检查**：
   - 在包含大量笔记的 vault 中测试引用检查
   - 验证检查速度是否可接受

### 6. 主题兼容性测试

1. 切换到浅色主题，验证样式是否正常
2. 切换到深色主题，验证样式是否正常
3. 测试不同的社区主题

## 常见问题排查

### 问题：插件无法加载

**解决方案：**
1. 检查控制台是否有错误（按 `Ctrl+Shift+I` 打开开发者工具）
2. 确认三个文件（main.js, manifest.json, styles.css）都在正确的位置
3. 尝试禁用并重新启用插件

### 问题：图片不显示

**解决方案：**
1. 检查文件夹路径设置是否正确
2. 确认图片文件格式受支持（jpg, jpeg, png, gif, bmp, svg, webp, agx）
3. 检查文件路径是否包含特殊字符

### 问题：引用检查很慢

**解决方案：**
1. 关闭"加载时自动检查引用"选项
2. 手动触发引用检查
3. 考虑减少检查的文件夹范围

### 问题：样式显示异常

**解决方案：**
1. 确认 styles.css 文件已正确安装
2. 尝试重启 Obsidian
3. 检查是否与其他插件的样式冲突

## 开发模式测试

如果你想在开发模式下测试：

```powershell
# 启动开发模式（自动重新构建）
npm run dev
```

然后使用符号链接将构建输出链接到你的 vault：

```powershell
# Windows（需要管理员权限）
New-Item -ItemType SymbolicLink -Path "$vaultPath\.obsidian\plugins\albus-figure-manager" -Target "C:\Users\郭雨阳\Documents\GitHub\albus-figure-manager"
```

这样，每次代码更改后会自动重新构建，只需重新加载 Obsidian 即可看到更改。

## 报告问题

如果发现任何问题，请记录：
1. 问题描述
2. 重现步骤
3. Obsidian 版本
4. 控制台错误信息（如果有）
5. 截图（如果适用）

## 功能清单

### 已实现的功能 ✅

- [x] 图片网格显示
- [x] 图片缩略图加载
- [x] 搜索图片
- [x] 排序（按名称、时间、大小）
- [x] 过滤未引用图片
- [x] 引用检查
- [x] 引用计数显示
- [x] 双击打开图片
- [x] 图片预览（缩放、拖动）
- [x] 文件重命名
- [x] 文件删除
- [x] AGX/SVG 文件配对
- [x] 设置界面
- [x] 主题适配（浅色/深色）
- [x] 响应式布局
- [x] 文件大小显示
- [x] 修改时间显示
- [x] 删除确认

### 架构特性 ✅

- [x] 7 层架构设计
- [x] 类型安全（TypeScript）
- [x] 分离的 CSS 文件
- [x] 服务层抽象
- [x] 组件化设计
- [x] 低耦合高内聚
- [x] React 设置界面
- [x] 缓存机制

## 后续改进建议

1. **性能优化**：
   - 实现虚拟滚动以支持大量图片
   - 添加图片懒加载
   - 优化引用检查算法

2. **功能增强**：
   - 批量操作（批量重命名、批量删除）
   - 图片标签系统
   - 图片收藏功能
   - 导出报告功能

3. **用户体验**：
   - 添加快捷键支持
   - 改进拖拽交互
   - 添加加载动画
   - 优化移动端体验（如果支持移动端）

4. **文档完善**：
   - 添加用户手册
   - 创建视频教程
   - 提供常见问题解答
